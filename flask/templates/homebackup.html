<!DOCTYPE html>
<html lang="en">
<head>
  <link href="styles.css" rel="stylesheet">
  <style>
    body {
    font-size: 16px;
    line-height: 1.8;
    font-weight: normal;
    color: gray;
}
.teal {
    color:#0b4465;
}
#upload-container {
      display: flex;
      align-items: flex-start; 
      justify-content: flex-start; 
      position: relative;
      overflow: hidden;
      margin-right: 10px;
      border: 20px solid #edeff2;
      border-radius: 10px;
      margin-bottom: 10px;
      min-height: 45vh;
      width: 90vh; 
      padding: 20px;
      margin-top: 40px;
  }
  
  #refresh-btn {
        background-color: #002F31;
        color: white;
        font-weight: 500;
        margin-left: 15px; 
        margin-top: 20px; 
        font-size: 20px;
        padding: 10px 50px;
        cursor: pointer;
        border-radius: 5px; 
      }

      #start-stop-btn {
        background-color: #0b4465;
        color: white;
        font-weight: 500;
        margin-left: 0; 
        margin-top: 20px; 
        font-size: 20px;
        padding: 10px 50px;
        cursor: pointer;
        border-radius: 5px;
        border:none !important;
      }

      #capture-btn {
        background-color: #0b4465;
        color: white;
        font-weight: 500;
        margin-left: 0; 
        margin-top: 20px; 
        font-size: 20px;
        padding: 10px 50px;
        cursor: pointer;
        border-radius: 5px; 
        border:none !important;
      }

      .navbar {
    background: #0b4465 !important;
    color:white !important;
    font-size: 19px;
  }

  
.navbar a{
  color:white !important;
  text-decoration: none !important;
}

.nav-link {
  display: block;
  padding: .5rem 1rem;
  color: white !important;
  text-decoration: none;
  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out;
}

.navbar .navbar-toggler {
  background-color: white;
}

.navbar .navbar-toggler-icon {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30"><path stroke="rgba(0, 0, 0, 0.55)" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"/></svg>');
}

/* folder structure */
.folder-list {
    list-style: none;
    padding: 0;
}
.folder-item {
    margin-bottom: 10px;
    padding-left: 30px;
    position: relative;
}
.folder-icon {
    position: absolute;
    left: 0;
    top: 0;
    color: #607D8B;
}
.folder-name {
    margin-left: 30px;
    position: relative;
}
.delete-icon {
    position: absolute;
    right: 0;
    top: 0;
    color: red;
}
.folder-name:hover .delete-icon {
    visibility: visible;
}
  </style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <title>Login Page</title>
</head>
<body>   
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
        aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
          
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
               
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="{{ url_for('home') }}">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('settings', username=username) }}">Settings</a> 
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('gallery') }}">Gallery</a> 
                </li>
               
                <li class="nav-item">
                    <a class="nav-link">Log Out</a>
                </li>

            
                
            </ul>
       
        </div>
    </div>
</nav>
<div class="container">
  <h3 class=" mt-5 teal">Video Feed</h3>
  <div class="image-cont">
      <div id="upload-container">
          <video id="video-element" autoplay></video>
      </div>
      <div style = "display:flex;">
          <button id="start-stop-btn">Start/Stop</button>
          <button id="capture-btn" style ="margin-left:23px;">Capture</button>
          <canvas id="canvas" width="640" height="360" style="display: none;"></canvas>
         
      </div>
    </div>
      
    <!-- select option -->

    <div>
      <label for="folder-action">Select an action:</label>
      <select id="folder-action">
        <option value="select">select</option>
        <option value="create">Create Folder</option>
        <option value="list">Show List of Folders</option>
      </select>
    </div>
<!-- select option -->

  <!-- Create Folder Popup -->
  <div id="create-folder-popup" style="display: none; background-color: rgba(0, 0, 0, 0.5); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; justify-content: center; align-items: center;">
    <div style="background-color: white; padding: 20px; border-radius: 10px;">
      <h1>Create Folder</h1>
      <form id="create-folder-form">
        <label for="folder-name">Folder Name:</label>
        <input type="text" id="folder-name" name="folder_name">
        <button type="submit">Create Folder</button>
      </form>
      <div id="response-message"></div>
      <button id="close-popup">Close</button>
    </div>
  </div>

  <div id="response-message"></div>

  <!-- <h1>Delete Folder</h1>
    <form id="delete-folder-form">
      <label for="delete-folder-name">Folder Name:</label>
      <input type="text" id="delete-folder-name" name="folder_name">
      <button type="submit">Delete Folder</button>
    </form> -->

    <div id="delete-folder-popup" style="display: none; background-color: rgba(0, 0, 0, 0.5); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; justify-content: center; align-items: center;">
      <div style="background-color: white; padding: 20px; border-radius: 10px;">
        <h1>Create Folder</h1>
        <form id="delete-folder-form">
          <label for="delete-folder-name">Folder Name:</label>
          <input type="text" id="delete-folder-name" name="folder_name">
          <button type="submit">Delete Folder</button>
        </form>
        <div id="response-message"></div>
        <button id="close-popup-delete">Close</button>
      </div>
    </div>
  
    <div id="response-message"></div>

<!-- Add a section to display the list of folders -->
<div id="folder-list" style="display: none;">
    <h1>List of Folders</h1>
    <ul class="folder-list" id="folders">
      <!-- Folders will be dynamically added here -->
  </ul>
</div>
</div> 




  <script>
     document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('folder-action').addEventListener('change', function() {
      var selectedOption = this.value;
      if (selectedOption === 'create') {
        document.getElementById('create-folder-popup').style.display = 'flex';
      } else {
        document.getElementById('create-folder-popup').style.display = 'none';
      }
    });

    document.getElementById('create-folder-form').addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent form submission
      
      // Get the folder name from the input field
      const folderName = document.getElementById('folder-name').value;

      // Send a POST request to the Flask endpoint
      fetch('/create_folder', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ folder_name: folderName })
      })
      .then(response => response.json())
      .then(data => {
        // Display response message
        document.getElementById('response-message').innerText = data.message || data.error;
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });

    // Close the popup when the close button is clicked
    document.getElementById('close-popup').addEventListener('click', function() {
      document.getElementById('create-folder-popup').style.display = 'none';
      updateFolderList();
    });

    
  
    document.getElementById('folder-action').addEventListener('change', function() {
      var selectedOption = this.value;
      if (selectedOption === 'list') {
        document.getElementById('folder-list').style.display = 'block';
      } else {
        document.getElementById('folder-list').style.display = 'none';
      }
    });

    // Fetch the list of folders from the server and update the HTML content
    fetch('/list_folders')
      .then(response => response.json())
      .then(data => {
        const foldersList = document.getElementById('folders');
        if (data.folders && data.folders.length > 0) {
          // Clear existing list items
          foldersList.innerHTML = '';
          // Iterate through the folders and create list items
          data.folders.forEach(folder => {
            const listItem = document.createElement('li');
            listItem.classList.add('folder-item');
            const folderIcon = document.createElement('i');
            folderIcon.classList.add('fa', 'fa-folder', 'folder-icon');
            const folderName = document.createElement('span');
            folderName.classList.add('folder-name');
            folderName.textContent = folder;
            listItem.appendChild(folderIcon);
            listItem.appendChild(folderName);
                        
            // Add delete icon
            const deleteIcon = document.createElement('i');
            deleteIcon.classList.add('fa', 'fa-trash', 'delete-icon');
            listItem.appendChild(deleteIcon);

            foldersList.appendChild(listItem);
          });
        } else {
          // No folders found
          foldersList.innerHTML = '<li>No folders found</li>';
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });


 

    // Function to update the list of folders
function updateFolderList() {
  axios.get('/list_folders')
    .then(response => {
      const foldersList = document.getElementById('folders');
      foldersList.innerHTML = ''; // Clear existing list items

      if (response.data.folders && response.data.folders.length > 0) {
        response.data.folders.forEach(folder => {
          const listItem = document.createElement('li');
          listItem.classList.add('folder-item');

          // Create folder icon
          const folderIcon = document.createElement('i');
          folderIcon.classList.add('fa', 'fa-folder', 'folder-icon');

          // Create folder name span
          const folderName = document.createElement('span');
          folderName.classList.add('folder-name');
          folderName.textContent = folder;

          listItem.appendChild(folderIcon);
          listItem.appendChild(folderName);

          foldersList.appendChild(listItem);
        });
      } else {
        foldersList.innerHTML = '<li>No folders found</li>';
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

document.getElementById('delete-folder-form').addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent form submission
      
      // Get the folder name from the input field
      const folderName = document.getElementById('delete-folder-name').value;

      // Send a POST request to the Flask endpoint to delete the folder
      axios.post('/delete_folder', { folder_name: folderName })
        .then(response => {
          // Display response message
          document.getElementById('response-message').innerText = response.data.message || response.data.error;
          // Update the folder list
          updateFolderList();
        })
        .catch(error => {
          console.error('Error:', error);
        });
    });

  
// Add event listener to delete icons
document.addEventListener('click', function(event) {
      if (event.target && event.target.classList.contains('delete-icon')) {
        // Show an alert when the delete icon is clicked
        document.getElementById('delete-folder-popup').style.display = 'flex';
        // You can also implement further logic here to handle the deletion
      }
   
    });
    updateFolderList();

        // Add event listener to close the delete-folder-popup
        document.getElementById('close-popup-delete').addEventListener('click', function() {
      // Hide the delete-folder-popup
      document.getElementById('delete-folder-popup').style.display = 'none';
    });
    updateFolderList();
});
  </script>
</body>
</html>
